<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Api Browser</title>
    <script src="/Scripts/knockout-1.3.0beta.js" type="text/javascript"></script>
    <script src="/Scripts/jquery-1.7.js" type="text/javascript"></script>
</head>
<body>
<script type="text/javascript">

    function ApiViewModel() {
        this.links = ko.observableArray([]);

        this.currentHtml = ko.observable();
        this.currentUri = ko.observable("/api");
        var self = this;

        this.refresh = function () {
            $.getJSON(self.currentUri(), {}, function (data, status) {

                var html = self.buildHtml(data);
                self.currentHtml(html);
            });
        };

        this.buildHtml = function (obj) {
            if (obj.Uri && obj.Rel) {
                return "<a href=\"#\" onclick=\"viewModel.currentUri('" + obj.Uri + "'); viewModel.refresh(); return false;\">" + obj.Rel + "</a>";
            }
            
            if ($.isArray(obj) || $.isPlainObject(obj)) {
                var html = "<ul>";
                var subObjs = $.map(obj, function (data, idx) { return "<b>" + idx + "</b> " + self.buildHtml(data); });

                $.each(subObjs, function (idx) { html += "<li>" + subObjs[idx] + "</li>"; });
                html += "</ul>";

                return html;
            }

            return obj.toString();
        };
    }

    var viewModel = new ApiViewModel();

    $(function () {

        ko.applyBindings(viewModel);
        viewModel.refresh();
    });
    
</script>
    <h1>Api navigator</h1>
    
    <div id="contents" data-bind="html: currentHtml"></div>

</body>
</html>
