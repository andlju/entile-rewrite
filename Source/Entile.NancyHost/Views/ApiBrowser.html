<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Api Browser</title>
    <script src="/Scripts/knockout-1.3.0beta.js" type="text/javascript"></script>
    <script src="/Scripts/jquery-1.7.js" type="text/javascript"></script>
</head>
<body>
<script type="text/javascript">

    function Link(uri, rel) {
        this.linkUri = ko.observable(uri);
        this.rel = ko.observable(rel);

        var self = this;

        this.select = function () {
            viewModel.currentUri(self.linkUri());
            viewModel.refresh();
        };
    }

    function ApiViewModel() {
        this.links = ko.observableArray([]);

        this.currentUri = ko.observable("/api");
        var self = this;

        this.refresh = function () {
            $.getJSON(self.currentUri(), {}, function (data, status) {

                var linkList = $.map(data.Links, function (item, no) {
                    return new Link(item.Uri, item.Rel);
                });
                self.links(linkList);
            });
        };
    }

    var viewModel = new ApiViewModel();

    $(function () {

        ko.applyBindings(viewModel);
        viewModel.refresh();
    });
    
</script>
    <h1>Api navigator</h1>

    <ul>
        <div data-bind="template: {name: 'linkListItemTemplate', foreach: links}"></div>
    </ul>

    <script id="linkListItemTemplate" type="text/html">
        <li>
            <a href="#" data-bind="text: rel, click: select"></a>
        </li>
    </script>
</body>
</html>
